#! /bin/bash
mkdir -p result
conv_log_file=result/conv.block_sparse.csv

conv_shapes="64,112,112,3,64,7,7,2 \
64,56,56,64,64,1,1,1 \
64,56,56,256,64,1,1,1 \
64,56,56,64,64,3,3,1 \
64,56,56,64,256,1,1,1 \
64,56,56,256,128,1,1,1 \
64,28,28,512,128,1,1,1 \
64,28,28,128,128,3,3,2 \
64,28,28,128,128,3,3,1 \
64,28,28,128,512,1,1,1 \
64,28,28,256,512,1,1,2 \
64,28,28,512,256,1,1,1 \
64,14,14,1024,256,1,1,1 \
64,14,14,256,256,3,3,2 \
64,14,14,256,256,3,3,1 \
64,14,14,256,1024,1,1,1 \
64,14,14,512,1024,1,1,2 \
64,14,14,1024,512,1,1,1 \
64,7,7,2048,512,1,1,1 \
64,7,7,512,512,3,3,2 \
64,7,7,512,512,3,3,1 \
64,7,7,512,2048,1,1,1 \
64,7,7,1024,2048,1,1,2 \
16,112,112,3,64,7,7,2 \
16,56,56,64,64,1,1,1 \
16,56,56,256,64,1,1,1 \
16,56,56,64,64,3,3,1 \
16,56,56,64,256,1,1,1 \
16,56,56,256,128,1,1,1 \
16,28,28,512,128,1,1,1 \
16,28,28,128,128,3,3,2 \
16,28,28,128,128,3,3,1 \
16,28,28,128,512,1,1,1 \
16,28,28,256,512,1,1,2 \
16,28,28,512,256,1,1,1 \
16,14,14,1024,256,1,1,1 \
16,14,14,256,256,3,3,2 \
16,14,14,256,256,3,3,1 \
16,14,14,256,1024,1,1,1 \
16,14,14,512,1024,1,1,2 \
16,14,14,1024,512,1,1,1 \
16,7,7,2048,512,1,1,1 \
16,7,7,512,512,3,3,2 \
16,7,7,512,512,3,3,1 \
16,7,7,512,2048,1,1,1 \
16,7,7,1024,2048,1,1,2"

for shape in $conv_shapes; do
IFS="," ; set -- $shape
for d in 0.02 0.05 0.1 0.15 0.2 0.25 0.5; do
for block_sz in 32 64 128; do
block_sparse/benchmark/benchmark.spconv.out --B $1 --H $2 --W $3 --C $4 --F $5 --R $6 --S $7 --stride $8 --d $d --sparsity-type block --block-size $block_sz --row-permute >> $conv_log_file
done; done; done